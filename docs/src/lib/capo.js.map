{"mappings":"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","sources":["<anon>","src/web/capo.js","src/main.js","src/lib/colors.js","src/lib/io.js","src/lib/options.js","src/lib/rules.js","src/lib/validation.js","src/snippet/logging.js"],"sourcesContent":["function $parcel$export(e, n, v, s) {\n  Object.defineProperty(e, n, {get: v, set: s, enumerable: true, configurable: true});\n}\nconst $aea261a6e7bc108a$var$Hues = {\n    PINK: 320,\n    BLUE: 200\n};\nfunction $aea261a6e7bc108a$export$921514c0345db5eb(hue) {\n    return [\n        `oklch(5% .1 ${hue})`,\n        `oklch(13% .2 ${hue})`,\n        `oklch(25% .2 ${hue})`,\n        `oklch(35% .25 ${hue})`,\n        `oklch(50% .27 ${hue})`,\n        `oklch(67% .31 ${hue})`,\n        `oklch(72% .25 ${hue})`,\n        `oklch(80% .2 ${hue})`,\n        `oklch(90% .1 ${hue})`,\n        `oklch(99% .05 ${hue})`,\n        \"#ccc\"\n    ];\n}\nconst $aea261a6e7bc108a$export$e6952b12ade67489 = [\n    \"#9e0142\",\n    \"#d53e4f\",\n    \"#f46d43\",\n    \"#fdae61\",\n    \"#fee08b\",\n    \"#e6f598\",\n    \"#abdda4\",\n    \"#66c2a5\",\n    \"#3288bd\",\n    \"#5e4fa2\",\n    \"#cccccc\"\n];\nconst $aea261a6e7bc108a$export$d68d0fda4a10dbc2 = $aea261a6e7bc108a$export$921514c0345db5eb($aea261a6e7bc108a$var$Hues.PINK);\nconst $aea261a6e7bc108a$export$738c3b9a44c87ecc = $aea261a6e7bc108a$export$921514c0345db5eb($aea261a6e7bc108a$var$Hues.BLUE);\nconst $aea261a6e7bc108a$export$9a82c28ef488e918 = {\n    DEFAULT: $aea261a6e7bc108a$export$e6952b12ade67489,\n    PINK: $aea261a6e7bc108a$export$d68d0fda4a10dbc2,\n    BLUE: $aea261a6e7bc108a$export$738c3b9a44c87ecc\n};\nfunction $aea261a6e7bc108a$export$18c940335d915715(elementColor) {\n    let invalidColor = \"#cccccc\";\n    if (elementColor == invalidColor) invalidColor = \"red\";\n    return `repeating-linear-gradient(45deg, ${elementColor}, ${elementColor} 3px, ${invalidColor} 3px, ${invalidColor} 6px)`;\n}\n\n\nvar $87bbfeee3d3104be$exports = {};\n\n$parcel$export($87bbfeee3d3104be$exports, \"IO\", () => $87bbfeee3d3104be$export$8f8422ac5947a789);\n\nclass $87bbfeee3d3104be$export$8f8422ac5947a789 {\n    constructor(document1, options, output = window.console){\n        this.document = document1;\n        this.options = options;\n        this.console = output;\n        this.isStaticHead = false;\n        this.head = null;\n    }\n    async init() {\n        if (this.head) return;\n        if (this.options.prefersDynamicAssessment()) {\n            this.head = this.document.head;\n            return;\n        }\n        try {\n            let html = await this.getStaticHTML();\n            html = html.replace(/(\\<\\/?)(head)/ig, \"$1static-head\");\n            const staticDoc = this.document.implementation.createHTMLDocument(\"New Document\");\n            staticDoc.documentElement.innerHTML = html;\n            this.head = staticDoc.querySelector(\"static-head\");\n            if (this.head) this.isStaticHead = true;\n            else this.head = this.document.head;\n        } catch (e) {\n            this.console.error(`${this.options.loggingPrefix}An exception occurred while getting the static <head>:`, e);\n            this.head = this.document.head;\n        }\n        if (!this.isStaticHead) this.console.warn(`${this.options.loggingPrefix}Unable to parse the static (server-rendered) <head>. Falling back to document.head`, this.head);\n    }\n    async getStaticHTML() {\n        const url = this.document.location.href;\n        const response = await fetch(url);\n        return await response.text();\n    }\n    getHead() {\n        return this.head;\n    }\n    stringifyElement(element) {\n        return element.getAttributeNames().reduce((id, attr)=>{\n            return id += `[${CSS.escape(attr)}=${JSON.stringify(element.getAttribute(attr))}]`;\n        }, element.nodeName);\n    }\n    getLoggableElement(element) {\n        if (!this.isStaticHead) return element;\n        const selector = this.stringifyElement(element);\n        const candidates = Array.from(this.document.head.querySelectorAll(selector));\n        if (candidates.length == 0) return element;\n        if (candidates.length == 1) return candidates[0];\n        // The way the static elements are parsed makes their innerHTML different.\n        // Recreate the element in DOM and compare its innerHTML with those of the candidates.\n        // This ensures a consistent parsing and positive string matches.\n        const candidateWrapper = this.document.createElement(\"div\");\n        const elementWrapper = this.document.createElement(\"div\");\n        elementWrapper.innerHTML = element.innerHTML;\n        const candidate = candidates.find((c)=>{\n            candidateWrapper.innerHTML = c.innerHTML;\n            return candidateWrapper.innerHTML == elementWrapper.innerHTML;\n        });\n        if (candidate) return candidate;\n        return element;\n    }\n    // Note: AI-generated function.\n    createElementFromSelector(selector) {\n        // Extract the tag name from the selector\n        const tagName = selector.match(/^[A-Za-z]+/)[0];\n        if (!tagName) return;\n        // Create the new element\n        const element = document.createElement(tagName);\n        // Extract the attribute key-value pairs from the selector\n        const attributes = selector.match(/\\[([A-Za-z-]+)=\"([^\"]+)\"\\]/g) || [];\n        // Set the attributes on the new element\n        attributes.forEach((attribute)=>{\n            const [key, value] = attribute.replace(\"[\", \"\").replace(\"]\", \"\").split(\"=\");\n            element.setAttribute(key, value.slice(1, -1));\n        });\n        return element;\n    }\n    logElementFromSelector({ weight: weight, selector: selector, innerHTML: innerHTML, isValid: isValid, customValidations: customValidations = {} }) {\n        weight = +weight;\n        const viz = this.getElementVisualization(weight);\n        let element = this.createElementFromSelector(selector);\n        element.innerHTML = innerHTML;\n        element = this.getLoggableElement(element);\n        this.logElement({\n            viz: viz,\n            weight: weight,\n            element: element,\n            isValid: isValid,\n            customValidations: customValidations\n        });\n    }\n    logElement({ viz: viz, weight: weight, element: element, isValid: isValid, customValidations: customValidations, omitPrefix: omitPrefix = false }) {\n        if (!omitPrefix) viz.visual = `${this.options.loggingPrefix}${viz.visual}`;\n        let loggingLevel = \"log\";\n        const args = [\n            viz.visual,\n            viz.style,\n            weight + 1,\n            element\n        ];\n        if (!this.options.isValidationEnabled()) {\n            this.console[loggingLevel](...args);\n            return;\n        }\n        const { payload: payload, warnings: warnings } = customValidations;\n        if (payload) args.push(payload);\n        if (warnings?.length) {\n            // Element-specific warnings.\n            loggingLevel = \"warn\";\n            warnings.forEach((warning)=>args.push(`❌ ${warning}`));\n        } else if (!isValid && (this.options.prefersDynamicAssessment() || this.isStaticHead)) {\n            // General warnings.\n            loggingLevel = \"warn\";\n            args.push(`❌ invalid element (${element.tagName})`);\n        }\n        this.console[loggingLevel](...args);\n    }\n    logValidationWarnings(warnings) {\n        if (!this.options.isValidationEnabled()) return;\n        warnings.forEach(({ warning: warning, elements: elements = [], element: element })=>{\n            elements = elements.map(this.getLoggableElement.bind(this));\n            this.console.warn(`${this.options.loggingPrefix}${warning}`, ...elements, element || \"\");\n        });\n    }\n    getColor(weight) {\n        return this.options.palette[10 - weight];\n    }\n    getHeadVisualization(elements) {\n        let visual = \"\";\n        const styles = [];\n        elements.forEach(({ weight: weight, isValid: isValid })=>{\n            visual += \"%c \";\n            const color = this.getColor(weight);\n            let style = `padding: 5px; margin: 0 -1px; `;\n            if (isValid) style += `background-color: ${color};`;\n            else style += `background-image: ${(0, $aea261a6e7bc108a$export$18c940335d915715)(color)}`;\n            styles.push(style);\n        });\n        return {\n            visual: visual,\n            styles: styles\n        };\n    }\n    getElementVisualization(weight) {\n        const visual = `%c${new Array(weight + 1).fill(\"█\").join(\"\")}`;\n        const color = this.getColor(weight);\n        const style = `color: ${color}`;\n        return {\n            visual: visual,\n            style: style\n        };\n    }\n    visualizeHead(groupName, headElement, headWeights) {\n        const headViz = this.getHeadVisualization(headWeights);\n        this.console.groupCollapsed(`${this.options.loggingPrefix}${groupName} %chead%c order\\n${headViz.visual}`, \"font-family: monospace\", \"font-family: inherit\", ...headViz.styles);\n        headWeights.forEach(({ weight: weight, element: element, isValid: isValid, customValidations: customValidations })=>{\n            const viz = this.getElementVisualization(weight);\n            this.logElement({\n                viz: viz,\n                weight: weight,\n                element: element,\n                isValid: isValid,\n                customValidations: customValidations,\n                omitPrefix: true\n            });\n        });\n        this.console.log(`${groupName} %chead%c element`, \"font-family: monospace\", \"font-family: inherit\", headElement);\n        this.console.groupEnd();\n    }\n}\n\n\nvar $2bdfc45431959d07$exports = {};\n\n$parcel$export($2bdfc45431959d07$exports, \"Options\", () => $2bdfc45431959d07$export$c019608e5b5bb4cb);\n\nclass $2bdfc45431959d07$export$c019608e5b5bb4cb {\n    constructor({ preferredAssessmentMode: preferredAssessmentMode = $2bdfc45431959d07$export$c019608e5b5bb4cb.AssessmentMode.STATIC, validation: validation = true, palette: palette = $aea261a6e7bc108a$export$e6952b12ade67489, loggingPrefix: loggingPrefix = \"Capo: \" } = {}){\n        this.setPreferredAssessmentMode(preferredAssessmentMode);\n        this.setValidation(validation);\n        this.setPalette(palette);\n        this.setLoggingPrefix(loggingPrefix);\n    }\n    static get AssessmentMode() {\n        return {\n            STATIC: \"static\",\n            DYNAMIC: \"dynamic\"\n        };\n    }\n    static get Palettes() {\n        return $aea261a6e7bc108a$export$9a82c28ef488e918;\n    }\n    prefersStaticAssessment() {\n        return this.preferredAssessmentMode === $2bdfc45431959d07$export$c019608e5b5bb4cb.AssessmentMode.STATIC;\n    }\n    prefersDynamicAssessment() {\n        return this.preferredAssessmentMode === $2bdfc45431959d07$export$c019608e5b5bb4cb.AssessmentMode.DYNAMIC;\n    }\n    isValidationEnabled() {\n        return this.validation;\n    }\n    setPreferredAssessmentMode(preferredAssessmentMode) {\n        if (!this.isValidAssessmentMode(preferredAssessmentMode)) throw new Error(`Invalid option: preferred assessment mode, expected AssessmentMode.STATIC or AssessmentMode.DYNAMIC, got \"${preferredAssessmentMode}\".`);\n        this.preferredAssessmentMode = preferredAssessmentMode;\n    }\n    setPreferredAssessmentModeToStatic(prefersStatic) {\n        let mode = $2bdfc45431959d07$export$c019608e5b5bb4cb.AssessmentMode.STATIC;\n        if (!prefersStatic) mode = $2bdfc45431959d07$export$c019608e5b5bb4cb.AssessmentMode.DYNAMIC;\n        this.setPreferredAssessmentMode(mode);\n    }\n    setValidation(validation) {\n        if (!this.isValidValidation(validation)) throw new Error(`Invalid option: validation, expected boolean, got \"${validation}\".`);\n        this.validation = validation;\n    }\n    setPalette(palette) {\n        if (!this.isValidPalette(palette)) throw new Error(`Invalid option: palette, expected [${Object.keys($aea261a6e7bc108a$export$9a82c28ef488e918).join(\"|\")}] or an array of colors, got \"${palette}\".`);\n        if (typeof palette === \"string\") {\n            this.palette = $aea261a6e7bc108a$export$9a82c28ef488e918[palette];\n            return;\n        }\n        this.palette = palette;\n    }\n    setLoggingPrefix(loggingPrefix) {\n        if (!this.isValidLoggingPrefix(loggingPrefix)) throw new Error(`Invalid option: logging prefix, expected string, got \"${loggingPrefix}\".`);\n        this.loggingPrefix = loggingPrefix;\n    }\n    isValidAssessmentMode(assessmentMode) {\n        return Object.values($2bdfc45431959d07$export$c019608e5b5bb4cb.AssessmentMode).includes(assessmentMode);\n    }\n    isValidValidation(validation) {\n        return typeof validation === \"boolean\";\n    }\n    isValidPalette(palette) {\n        if (typeof palette === \"string\") return Object.keys($aea261a6e7bc108a$export$9a82c28ef488e918).includes(palette);\n        if (!Array.isArray(palette)) return false;\n        return palette.length === 11 && palette.every((color)=>typeof color === \"string\");\n    }\n    isValidLoggingPrefix(loggingPrefix) {\n        return typeof loggingPrefix === \"string\";\n    }\n    isPreferredPalette(palette) {\n        return JSON.stringify(this.palette) == JSON.stringify(palette);\n    }\n    valueOf() {\n        return {\n            preferredAssessmentMode: this.preferredAssessmentMode,\n            validation: this.validation,\n            palette: this.palette,\n            loggingPrefix: this.loggingPrefix\n        };\n    }\n}\n\n\nvar $8ce28ca40f3ccf50$exports = {};\n\n$parcel$export($8ce28ca40f3ccf50$exports, \"ElementWeights\", () => $8ce28ca40f3ccf50$export$881088883fcab450);\n$parcel$export($8ce28ca40f3ccf50$exports, \"ElementDetectors\", () => $8ce28ca40f3ccf50$export$6ade8bb3620eb74b);\n$parcel$export($8ce28ca40f3ccf50$exports, \"isMeta\", () => $8ce28ca40f3ccf50$export$daeb0db0c224decd);\n$parcel$export($8ce28ca40f3ccf50$exports, \"isTitle\", () => $8ce28ca40f3ccf50$export$e55aad21605f020a);\n$parcel$export($8ce28ca40f3ccf50$exports, \"isPreconnect\", () => $8ce28ca40f3ccf50$export$a3316bd0a640eb8b);\n$parcel$export($8ce28ca40f3ccf50$exports, \"isAsyncScript\", () => $8ce28ca40f3ccf50$export$20e2051ffd813ee3);\n$parcel$export($8ce28ca40f3ccf50$exports, \"isImportStyles\", () => $8ce28ca40f3ccf50$export$be443fc6335656f0);\n$parcel$export($8ce28ca40f3ccf50$exports, \"isSyncScript\", () => $8ce28ca40f3ccf50$export$65983fc0a5543400);\n$parcel$export($8ce28ca40f3ccf50$exports, \"isSyncStyles\", () => $8ce28ca40f3ccf50$export$9d6cdbffb13bee21);\n$parcel$export($8ce28ca40f3ccf50$exports, \"isPreload\", () => $8ce28ca40f3ccf50$export$226ad5ba23be83f0);\n$parcel$export($8ce28ca40f3ccf50$exports, \"isDeferScript\", () => $8ce28ca40f3ccf50$export$3d269f86e8bd1d24);\n$parcel$export($8ce28ca40f3ccf50$exports, \"isPrefetchPrerender\", () => $8ce28ca40f3ccf50$export$4d2ed086e1fec499);\n$parcel$export($8ce28ca40f3ccf50$exports, \"META_HTTP_EQUIV_KEYWORDS\", () => $8ce28ca40f3ccf50$export$b7417cf4a2235f73);\n$parcel$export($8ce28ca40f3ccf50$exports, \"isOriginTrial\", () => $8ce28ca40f3ccf50$export$38a04d482ec50f88);\n$parcel$export($8ce28ca40f3ccf50$exports, \"isMetaCSP\", () => $8ce28ca40f3ccf50$export$14b1a2f64a600585);\n$parcel$export($8ce28ca40f3ccf50$exports, \"getWeight\", () => $8ce28ca40f3ccf50$export$de32fe5d64aee40c);\n$parcel$export($8ce28ca40f3ccf50$exports, \"getHeadWeights\", () => $8ce28ca40f3ccf50$export$5cc4a311ddbe699c);\nconst $8ce28ca40f3ccf50$export$881088883fcab450 = {\n    META: 10,\n    TITLE: 9,\n    PRECONNECT: 8,\n    ASYNC_SCRIPT: 7,\n    IMPORT_STYLES: 6,\n    SYNC_SCRIPT: 5,\n    SYNC_STYLES: 4,\n    PRELOAD: 3,\n    DEFER_SCRIPT: 2,\n    PREFETCH_PRERENDER: 1,\n    OTHER: 0\n};\nconst $8ce28ca40f3ccf50$export$6ade8bb3620eb74b = {\n    META: $8ce28ca40f3ccf50$export$daeb0db0c224decd,\n    TITLE: $8ce28ca40f3ccf50$export$e55aad21605f020a,\n    PRECONNECT: $8ce28ca40f3ccf50$export$a3316bd0a640eb8b,\n    ASYNC_SCRIPT: $8ce28ca40f3ccf50$export$20e2051ffd813ee3,\n    IMPORT_STYLES: $8ce28ca40f3ccf50$export$be443fc6335656f0,\n    SYNC_SCRIPT: $8ce28ca40f3ccf50$export$65983fc0a5543400,\n    SYNC_STYLES: $8ce28ca40f3ccf50$export$9d6cdbffb13bee21,\n    PRELOAD: $8ce28ca40f3ccf50$export$226ad5ba23be83f0,\n    DEFER_SCRIPT: $8ce28ca40f3ccf50$export$3d269f86e8bd1d24,\n    PREFETCH_PRERENDER: $8ce28ca40f3ccf50$export$4d2ed086e1fec499\n};\nconst $8ce28ca40f3ccf50$export$b7417cf4a2235f73 = [\n    \"accept-ch\",\n    \"content-security-policy\",\n    \"content-type\",\n    \"default-style\",\n    \"delegate-ch\",\n    \"origin-trial\",\n    \"x-dns-prefetch-control\"\n];\nfunction $8ce28ca40f3ccf50$export$daeb0db0c224decd(element) {\n    const httpEquivSelector = $8ce28ca40f3ccf50$export$b7417cf4a2235f73.map((keyword)=>{\n        return `[http-equiv=\"${keyword}\" i]`;\n    }).join(\", \");\n    return element.matches(`meta:is([charset], ${httpEquivSelector}, [name=viewport]), base`);\n}\nfunction $8ce28ca40f3ccf50$export$e55aad21605f020a(element) {\n    return element.matches(\"title\");\n}\nfunction $8ce28ca40f3ccf50$export$a3316bd0a640eb8b(element) {\n    return element.matches(\"link[rel=preconnect]\");\n}\nfunction $8ce28ca40f3ccf50$export$20e2051ffd813ee3(element) {\n    return element.matches(\"script[src][async]\");\n}\nfunction $8ce28ca40f3ccf50$export$be443fc6335656f0(element) {\n    const importRe = /@import/;\n    if (element.matches(\"style\")) return importRe.test(element.textContent);\n    /* TODO: Support external stylesheets.\n  if (element.matches('link[rel=stylesheet][href]')) {\n    let response = fetch(element.href);\n    response = response.text();\n    return importRe.test(response);\n  } */ return false;\n}\nfunction $8ce28ca40f3ccf50$export$65983fc0a5543400(element) {\n    return element.matches(\"script:not([src][defer],[src][type=module],[src][async],[type*=json])\");\n}\nfunction $8ce28ca40f3ccf50$export$9d6cdbffb13bee21(element) {\n    return element.matches(\"link[rel=stylesheet],style\");\n}\nfunction $8ce28ca40f3ccf50$export$226ad5ba23be83f0(element) {\n    return element.matches(\"link:is([rel=preload], [rel=modulepreload])\");\n}\nfunction $8ce28ca40f3ccf50$export$3d269f86e8bd1d24(element) {\n    return element.matches(\"script[src][defer], script:not([src][async])[src][type=module]\");\n}\nfunction $8ce28ca40f3ccf50$export$4d2ed086e1fec499(element) {\n    return element.matches(\"link:is([rel=prefetch], [rel=dns-prefetch], [rel=prerender])\");\n}\nfunction $8ce28ca40f3ccf50$export$38a04d482ec50f88(element) {\n    return element.matches('meta[http-equiv=\"origin-trial\"i]');\n}\nfunction $8ce28ca40f3ccf50$export$14b1a2f64a600585(element) {\n    return element.matches('meta[http-equiv=\"Content-Security-Policy\" i]');\n}\nfunction $8ce28ca40f3ccf50$export$de32fe5d64aee40c(element) {\n    for ([id, detector] of Object.entries($8ce28ca40f3ccf50$export$6ade8bb3620eb74b)){\n        if (detector(element)) return $8ce28ca40f3ccf50$export$881088883fcab450[id];\n    }\n    return $8ce28ca40f3ccf50$export$881088883fcab450.OTHER;\n}\nfunction $8ce28ca40f3ccf50$export$5cc4a311ddbe699c(head) {\n    const headChildren = Array.from(head.children);\n    return headChildren.map((element)=>{\n        return {\n            element: element,\n            weight: $8ce28ca40f3ccf50$export$de32fe5d64aee40c(element)\n        };\n    });\n}\n\n\nvar $640aadc6e9fc01d4$exports = {};\n\n$parcel$export($640aadc6e9fc01d4$exports, \"VALID_HEAD_ELEMENTS\", () => $640aadc6e9fc01d4$export$79e124b7caef7aa9);\n$parcel$export($640aadc6e9fc01d4$exports, \"PRELOAD_SELECTOR\", () => $640aadc6e9fc01d4$export$5540ac2a18901364);\n$parcel$export($640aadc6e9fc01d4$exports, \"isValidElement\", () => $640aadc6e9fc01d4$export$a8257692ac88316c);\n$parcel$export($640aadc6e9fc01d4$exports, \"hasValidationWarning\", () => $640aadc6e9fc01d4$export$eeefd08c3a6f8db7);\n$parcel$export($640aadc6e9fc01d4$exports, \"getValidationWarnings\", () => $640aadc6e9fc01d4$export$b01ab94d0cd042a0);\n$parcel$export($640aadc6e9fc01d4$exports, \"getCustomValidations\", () => $640aadc6e9fc01d4$export$6c93e2175c028eeb);\n\nconst $640aadc6e9fc01d4$export$79e124b7caef7aa9 = new Set([\n    \"base\",\n    \"link\",\n    \"meta\",\n    \"noscript\",\n    \"script\",\n    \"style\",\n    \"template\",\n    \"title\"\n]);\nconst $640aadc6e9fc01d4$export$5540ac2a18901364 = 'link:is([rel=\"preload\" i], [rel=\"modulepreload\" i])';\nfunction $640aadc6e9fc01d4$export$a8257692ac88316c(element) {\n    return $640aadc6e9fc01d4$export$79e124b7caef7aa9.has(element.tagName.toLowerCase());\n}\nfunction $640aadc6e9fc01d4$export$eeefd08c3a6f8db7(element) {\n    // Element itself is not valid.\n    if (!$640aadc6e9fc01d4$export$a8257692ac88316c(element)) return true;\n    // Children are not valid.\n    if (element.matches(`:has(:not(${Array.from($640aadc6e9fc01d4$export$79e124b7caef7aa9).join(\", \")}))`)) return true;\n    // <title> is not the first of its type.\n    if (element.matches(\"title:is(:nth-of-type(n+2))\")) return true;\n    // <base> is not the first of its type.\n    if (element.matches(\"base:has(~ base), base ~ base\")) return true;\n    // CSP meta tag anywhere.\n    if ((0, $8ce28ca40f3ccf50$export$14b1a2f64a600585)(element)) return true;\n    // Origin trial expired or cross-origin.\n    if ($640aadc6e9fc01d4$var$isInvalidOriginTrial(element)) return true;\n    // Preload is unnecessary.\n    if ($640aadc6e9fc01d4$var$isUnnecessaryPreload(element)) return true;\n    return false;\n}\nfunction $640aadc6e9fc01d4$export$b01ab94d0cd042a0(head) {\n    const validationWarnings = [];\n    const titleElements = Array.from(head.querySelectorAll(\"title\"));\n    const titleElementCount = titleElements.length;\n    if (titleElementCount != 1) validationWarnings.push({\n        warning: `Expected exactly 1 <title> element, found ${titleElementCount}`,\n        elements: titleElements\n    });\n    const baseElements = Array.from(head.querySelectorAll(\"base\"));\n    const baseElementCount = baseElements.length;\n    if (baseElementCount > 1) validationWarnings.push({\n        warning: `Expected at most 1 <base> element, found ${baseElementCount}`,\n        elements: baseElements\n    });\n    const metaCSP = head.querySelector('meta[http-equiv=\"Content-Security-Policy\" i]');\n    if (metaCSP) validationWarnings.push({\n        warning: \"CSP meta tags disable the preload scanner due to a bug in Chrome. Use the CSP header instead. Learn more: https://crbug.com/1458493\",\n        element: metaCSP\n    });\n    head.querySelectorAll(\"*\").forEach((element)=>{\n        if ($640aadc6e9fc01d4$export$a8257692ac88316c(element)) return;\n        let root = element;\n        while(root.parentElement != head)root = root.parentElement;\n        validationWarnings.push({\n            warning: `${element.tagName} elements are not allowed in the <head>`,\n            element: root\n        });\n    });\n    const originTrials = Array.from(head.querySelectorAll('meta[http-equiv=\"Origin-Trial\" i]'));\n    originTrials.forEach((element)=>{\n        const metadata = $640aadc6e9fc01d4$var$validateOriginTrial(element);\n        if (metadata.warnings.length == 0) return;\n        validationWarnings.push({\n            warning: `Invalid origin trial token: ${metadata.warnings.join(\", \")}`,\n            elements: [\n                element\n            ],\n            element: metadata.payload\n        });\n    });\n    return validationWarnings;\n}\nfunction $640aadc6e9fc01d4$export$6c93e2175c028eeb(element) {\n    if ((0, $8ce28ca40f3ccf50$export$38a04d482ec50f88)(element)) return $640aadc6e9fc01d4$var$validateOriginTrial(element);\n    if ((0, $8ce28ca40f3ccf50$export$14b1a2f64a600585)(element)) return $640aadc6e9fc01d4$var$validateCSP(element);\n    if ($640aadc6e9fc01d4$var$isUnnecessaryPreload(element)) return $640aadc6e9fc01d4$var$validateUnnecessaryPreload(element);\n    return {};\n}\nfunction $640aadc6e9fc01d4$var$validateCSP(element) {\n    return {\n        warnings: [\n            \"meta CSP discouraged. See https://crbug.com/1458493.\"\n        ]\n    };\n}\nfunction $640aadc6e9fc01d4$var$isInvalidOriginTrial(element) {\n    if (!(0, $8ce28ca40f3ccf50$export$38a04d482ec50f88)(element)) return false;\n    const { warnings: warnings } = $640aadc6e9fc01d4$var$validateOriginTrial(element);\n    return warnings.length > 0;\n}\nfunction $640aadc6e9fc01d4$var$validateOriginTrial(element) {\n    const metadata = {\n        payload: null,\n        warnings: []\n    };\n    const token = element.getAttribute(\"content\");\n    try {\n        metadata.payload = $640aadc6e9fc01d4$var$decodeOriginTrialToken(token);\n        if (metadata.payload.expiry < new Date()) metadata.warnings.push(\"expired\");\n        if (!metadata.payload.isThirdParty && !$640aadc6e9fc01d4$var$isSameOrigin(metadata.payload.origin, document.location.href)) metadata.warnings.push(\"invalid origin\");\n    } catch  {\n        metadata.warnings.push(\"invalid token\");\n    }\n    return metadata;\n}\n// Adapted from https://glitch.com/~ot-decode.\nfunction $640aadc6e9fc01d4$var$decodeOriginTrialToken(token) {\n    const buffer = new Uint8Array([\n        ...atob(token)\n    ].map((a)=>a.charCodeAt(0)));\n    const view = new DataView(buffer.buffer);\n    const length = view.getUint32(65, false);\n    const payload = JSON.parse(new TextDecoder().decode(buffer.slice(69, 69 + length)));\n    payload.expiry = new Date(payload.expiry * 1000);\n    return payload;\n}\nfunction $640aadc6e9fc01d4$var$isSameOrigin(a, b) {\n    return new URL(a).origin === new URL(b).origin;\n}\nfunction $640aadc6e9fc01d4$var$isUnnecessaryPreload(element) {\n    if (!element.matches($640aadc6e9fc01d4$export$5540ac2a18901364)) return false;\n    const href = element.getAttribute(\"href\");\n    if (!href) return false;\n    const preloadedUrl = $640aadc6e9fc01d4$var$absolutifyUrl(href);\n    return $640aadc6e9fc01d4$var$findElementWithSource(element.parentElement, preloadedUrl) != null;\n}\nfunction $640aadc6e9fc01d4$var$findElementWithSource(root, sourceUrl) {\n    const linksAndScripts = Array.from(root.querySelectorAll(`link:not(${$640aadc6e9fc01d4$export$5540ac2a18901364}), script`));\n    return linksAndScripts.find((e)=>{\n        const src = e.getAttribute(\"href\") || e.getAttribute(\"src\");\n        if (!src) return false;\n        return sourceUrl == $640aadc6e9fc01d4$var$absolutifyUrl(src);\n    });\n}\nfunction $640aadc6e9fc01d4$var$absolutifyUrl(href) {\n    return new URL(href, document.baseURI).href;\n}\nfunction $640aadc6e9fc01d4$var$validateUnnecessaryPreload(element) {\n    const href = element.getAttribute(\"href\");\n    const preloadedUrl = $640aadc6e9fc01d4$var$absolutifyUrl(href);\n    const preloadedElement = $640aadc6e9fc01d4$var$findElementWithSource(element.parentElement, preloadedUrl);\n    if (!preloadedElement) throw new Error(\"Expected an invalid preload, but none found.\");\n    return {\n        warnings: [\n            `This preload has little to no effect. ${href} is already discoverable by another ${preloadedElement.tagName} element.`\n        ]\n    };\n}\n\n\n\n\nfunction $408f356d4b1f0dd4$export$8679af897d1c058e(io, validation) {\n    const validationWarnings = validation.getValidationWarnings(io.getHead());\n    io.logValidationWarnings(validationWarnings);\n}\nfunction $408f356d4b1f0dd4$export$b65597cffe09aebc(io, validation, rules) {\n    const headElement = io.getHead();\n    const headWeights = rules.getHeadWeights(headElement).map(({ element: element, weight: weight })=>{\n        return {\n            weight: weight,\n            element: io.getLoggableElement(element),\n            isValid: !validation.hasValidationWarning(element),\n            customValidations: validation.getCustomValidations(element)\n        };\n    });\n    io.visualizeHead(\"Actual\", headElement, headWeights);\n    const sortedWeights = Array.from(headWeights).sort((a, b)=>b.weight - a.weight);\n    const sortedHead = document.createElement(\"head\");\n    sortedWeights.forEach(({ element: element })=>{\n        sortedHead.appendChild(element.cloneNode(true));\n    });\n    io.visualizeHead(\"Sorted\", sortedHead, sortedWeights);\n    return headWeights;\n}\n\n\nconst $df99779bbb7ed58c$var$FORCED_OPTIONS = {\n    preferredAssessmentMode: $2bdfc45431959d07$exports.Options.AssessmentMode.STATIC\n};\nfunction $df99779bbb7ed58c$export$889ea624f2cb2c57(input, output, userOptions = {}) {\n    userOptions = Object.assign(userOptions, $df99779bbb7ed58c$var$FORCED_OPTIONS);\n    const staticDoc = this.document.implementation.createHTMLDocument(\"New Document\");\n    staticDoc.documentElement.innerHTML = input;\n    const options = new $2bdfc45431959d07$exports.Options(userOptions);\n    const io = new $87bbfeee3d3104be$exports.IO(staticDoc, options, output);\n    io.init();\n    $408f356d4b1f0dd4$export$8679af897d1c058e(io, $640aadc6e9fc01d4$exports);\n    $408f356d4b1f0dd4$export$b65597cffe09aebc(io, $640aadc6e9fc01d4$exports, $8ce28ca40f3ccf50$exports);\n}\n\n\n//# sourceMappingURL=capo.js.map\n","import * as capo from '../main.js';\nimport * as logging from '../snippet/logging.js';\n\n\nconst FORCED_OPTIONS = {\n  preferredAssessmentMode: capo.options.Options.AssessmentMode.STATIC\n};\n\n/**\n * Interface for the capo.js web client.\n * \n * For configuration options see:\n * https://rviscomi.github.io/capo.js/user/config/#configuring-the-snippet\n * \n * @param input HTML string\n * @param output Mock console implementation\n * @param options Capo options\n */\nexport function run(input, output, userOptions={}) {\n  userOptions = Object.assign(userOptions, FORCED_OPTIONS);\n\n  const staticDoc = this.document.implementation.createHTMLDocument('New Document');\n  staticDoc.documentElement.innerHTML = input;\n\n  const options = new capo.options.Options(userOptions);\n  const io = new capo.io.IO(staticDoc, options, output);\n\n  io.init();\n  logging.validateHead(io, capo.validation);\n  logging.logWeights(io, capo.validation, capo.rules);\n} \n","export * as colors from './lib/colors.js';\nexport * as io from './lib/io.js';\nexport * as options from './lib/options.js';\nexport * as rules from './lib/rules.js';\nexport * as validation from './lib/validation.js';\n","const Hues = {\n  PINK: 320,\n  BLUE: 200\n};\n\nexport function generateSwatches(hue) {\n  return [\n    `oklch(5% .1 ${hue})`,\n    `oklch(13% .2 ${hue})`,\n    `oklch(25% .2 ${hue})`,\n    `oklch(35% .25 ${hue})`,\n    `oklch(50% .27 ${hue})`,\n    `oklch(67% .31 ${hue})`,\n    `oklch(72% .25 ${hue})`,\n    `oklch(80% .2 ${hue})`,\n    `oklch(90% .1 ${hue})`,\n    `oklch(99% .05 ${hue})`,\n    '#ccc'\n  ];\n}\n\nexport const DEFAULT = [\n  '#9e0142',\n  '#d53e4f',\n  '#f46d43',\n  '#fdae61',\n  '#fee08b',\n  '#e6f598',\n  '#abdda4',\n  '#66c2a5',\n  '#3288bd',\n  '#5e4fa2',\n  '#cccccc'\n];\n\nexport const PINK = generateSwatches(Hues.PINK);\nexport const BLUE = generateSwatches(Hues.BLUE);\n\nexport const Palettes = {\n  DEFAULT: DEFAULT,\n  PINK: PINK,\n  BLUE: BLUE\n};\n\nexport function getInvalidBackgroundColor(elementColor) {\n  let invalidColor = '#cccccc';\n  if (elementColor == invalidColor) {\n    invalidColor = 'red';\n  }\n  return `repeating-linear-gradient(45deg, ${elementColor}, ${elementColor} 3px, ${invalidColor} 3px, ${invalidColor} 6px)`;\n}\n","import { getInvalidBackgroundColor } from './colors.js'\n\nexport class IO {\n\n  constructor(document, options, output = window.console) {\n    this.document = document;\n    this.options = options;\n    this.console = output;\n    this.isStaticHead = false;\n    this.head = null;\n  }\n\n  async init() {\n    if (this.head) {\n      return;\n    }\n\n    if (this.options.prefersDynamicAssessment()) {\n      this.head = this.document.head;\n      return;\n    }\n\n    try {\n      let html = await this.getStaticHTML();\n      html = html.replace(/(\\<\\/?)(head)/ig, '$1static-head');\n      const staticDoc = this.document.implementation.createHTMLDocument('New Document');\n      staticDoc.documentElement.innerHTML = html;\n      this.head = staticDoc.querySelector('static-head');\n      \n      if (this.head) {\n        this.isStaticHead = true;\n      } else {\n        this.head = this.document.head;\n      }\n    } catch (e) {\n      this.console.error(`${this.options.loggingPrefix}An exception occurred while getting the static <head>:`, e);\n      this.head = this.document.head;\n    }\n\n    if (!this.isStaticHead) {\n      this.console.warn(`${this.options.loggingPrefix}Unable to parse the static (server-rendered) <head>. Falling back to document.head`, this.head);\n    }\n  }\n\n  async getStaticHTML() {\n    const url = this.document.location.href;\n    const response = await fetch(url);\n    return await response.text();\n  }\n\n  getHead() {\n    return this.head;\n  }\n\n  stringifyElement(element) {\n    return element.getAttributeNames().reduce((id, attr) => {\n      return id += `[${CSS.escape(attr)}=${JSON.stringify(element.getAttribute(attr))}]`;\n    }, element.nodeName);\n  }\n  \n  getLoggableElement(element) {\n    if (!this.isStaticHead) {\n      return element;\n    }\n\n    const selector = this.stringifyElement(element);\n    const candidates = Array.from(this.document.head.querySelectorAll(selector));\n    if (candidates.length == 0) {\n      return element;\n    }\n    if (candidates.length == 1) {\n      return candidates[0];\n    }\n\n    // The way the static elements are parsed makes their innerHTML different.\n    // Recreate the element in DOM and compare its innerHTML with those of the candidates.\n    // This ensures a consistent parsing and positive string matches.\n    const candidateWrapper = this.document.createElement('div');\n    const elementWrapper = this.document.createElement('div');\n    elementWrapper.innerHTML = element.innerHTML;\n    const candidate = candidates.find(c => {\n      candidateWrapper.innerHTML = c.innerHTML;\n      return candidateWrapper.innerHTML == elementWrapper.innerHTML;\n    });\n    if (candidate) {\n      return candidate;\n    }\n    \n    return element;\n  }\n\n  // Note: AI-generated function.\n  createElementFromSelector(selector) {\n    // Extract the tag name from the selector\n    const tagName = selector.match(/^[A-Za-z]+/)[0];\n\n    if (!tagName) {\n      return;\n    }\n  \n    // Create the new element\n    const element = document.createElement(tagName);\n  \n    // Extract the attribute key-value pairs from the selector\n    const attributes = selector.match(/\\[([A-Za-z-]+)=\"([^\"]+)\"\\]/g) || [];\n  \n    // Set the attributes on the new element\n    attributes.forEach(attribute => {\n      const [key, value] = attribute\n        .replace('[', '')\n        .replace(']', '')\n        .split('=');\n      element.setAttribute(key, value.slice(1, -1));\n    });\n  \n    return element;\n  }\n\n  logElementFromSelector({weight, selector, innerHTML, isValid, customValidations={}}) {\n    weight = +weight;\n    const viz = this.getElementVisualization(weight);\n    let element = this.createElementFromSelector(selector);\n    element.innerHTML = innerHTML;\n    element = this.getLoggableElement(element);\n\n    this.logElement({viz, weight, element, isValid, customValidations});\n  }\n\n  logElement({viz, weight, element, isValid, customValidations, omitPrefix = false}) {\n    if (!omitPrefix) {\n      viz.visual = `${this.options.loggingPrefix}${viz.visual}`;\n    }\n\n    let loggingLevel = 'log';\n    const args = [viz.visual, viz.style, weight + 1, element];\n\n    if (!this.options.isValidationEnabled()) {\n      this.console[loggingLevel](...args);\n      return;\n    }\n\n    const {payload, warnings} = customValidations;\n    if (payload) {\n      args.push(payload);\n    }\n\n    if (warnings?.length) {\n      // Element-specific warnings.\n      loggingLevel = 'warn';\n      warnings.forEach(warning => args.push(`❌ ${warning}`));\n    } else if (!isValid && (this.options.prefersDynamicAssessment() || this.isStaticHead)) {\n      // General warnings.\n      loggingLevel = 'warn';\n      args.push(`❌ invalid element (${element.tagName})`);\n    }\n\n    this.console[loggingLevel](...args);\n  }\n\n  logValidationWarnings(warnings) {\n    if (!this.options.isValidationEnabled()) {\n      return;\n    }\n  \n    warnings.forEach(({warning, elements=[], element}) => {\n      elements = elements.map(this.getLoggableElement.bind(this));\n      this.console.warn(`${this.options.loggingPrefix}${warning}`, ...elements, element || '');\n    });\n  }\n\n  getColor(weight) {\n    return this.options.palette[10 - weight];\n  }\n\n  getHeadVisualization(elements) {\n    let visual = '';\n    const styles = [];\n\n    elements.forEach(({weight, isValid}) => {\n      visual += '%c ';\n      \n      const color = this.getColor(weight);\n      let style = `padding: 5px; margin: 0 -1px; `;\n\n      if (isValid) {\n        style += `background-color: ${color};`;\n      } else {\n        style += `background-image: ${getInvalidBackgroundColor(color)}`;\n      }\n\n      styles.push(style);\n    });\n\n    return {visual, styles};\n  }\n\n  getElementVisualization(weight) {\n    const visual = `%c${new Array(weight + 1).fill('█').join('')}`;\n    const color = this.getColor(weight);\n    const style = `color: ${color}`;\n  \n    return {visual, style};\n  }\n\n  visualizeHead(groupName, headElement, headWeights) {\n    const headViz = this.getHeadVisualization(headWeights);\n\n    this.console.groupCollapsed(`${this.options.loggingPrefix}${groupName} %chead%c order\\n${headViz.visual}`, 'font-family: monospace', 'font-family: inherit',  ...headViz.styles);\n    \n    headWeights.forEach(({weight, element, isValid, customValidations}) => {\n      const viz = this.getElementVisualization(weight);\n      this.logElement({viz, weight, element, isValid, customValidations, omitPrefix: true});\n    });\n    \n    this.console.log(`${groupName} %chead%c element`, 'font-family: monospace', 'font-family: inherit', headElement);\n    \n    this.console.groupEnd();\n  }\n\n}\n","import * as colors from './colors.js';\n\nexport class Options {\n\n  constructor({\n    preferredAssessmentMode = Options.AssessmentMode.STATIC,\n    validation = true,\n    palette = colors.DEFAULT,\n    loggingPrefix = 'Capo: '\n  } = {}) {\n    this.setPreferredAssessmentMode(preferredAssessmentMode);\n    this.setValidation(validation);\n    this.setPalette(palette);\n    this.setLoggingPrefix(loggingPrefix);\n  }\n\n  static get AssessmentMode() {\n    return {\n      STATIC: 'static',\n      DYNAMIC: 'dynamic'\n    };\n  }\n\n  static get Palettes() {\n    return colors.Palettes;\n  }\n\n  prefersStaticAssessment() {\n    return this.preferredAssessmentMode === Options.AssessmentMode.STATIC;\n  }\n\n  prefersDynamicAssessment() {\n    return this.preferredAssessmentMode === Options.AssessmentMode.DYNAMIC;\n  }\n\n  isValidationEnabled() {\n    return this.validation;\n  }\n\n  setPreferredAssessmentMode(preferredAssessmentMode) {\n    if (!this.isValidAssessmentMode(preferredAssessmentMode)) {\n      throw new Error(`Invalid option: preferred assessment mode, expected AssessmentMode.STATIC or AssessmentMode.DYNAMIC, got \"${preferredAssessmentMode}\".`);\n    }\n\n    this.preferredAssessmentMode = preferredAssessmentMode;\n  }\n\n  setPreferredAssessmentModeToStatic(prefersStatic) {\n    let mode = Options.AssessmentMode.STATIC;\n    if (!prefersStatic) {\n      mode = Options.AssessmentMode.DYNAMIC;\n    }\n    \n    this.setPreferredAssessmentMode(mode);\n  }\n\n  setValidation(validation) {\n    if (!this.isValidValidation(validation)) {\n      throw new Error(`Invalid option: validation, expected boolean, got \"${validation}\".`);\n    }\n\n    this.validation = validation;\n  }\n\n  setPalette(palette) {\n    if (!this.isValidPalette(palette)) {\n      throw new Error(`Invalid option: palette, expected [${Object.keys(colors.Palettes).join('|')}] or an array of colors, got \"${palette}\".`);\n    }\n\n    if (typeof palette === 'string') {\n      this.palette = colors.Palettes[palette];\n      return;\n    }\n    \n    this.palette = palette;\n  }\n\n  setLoggingPrefix(loggingPrefix) {\n    if (!this.isValidLoggingPrefix(loggingPrefix)) {\n      throw new Error(`Invalid option: logging prefix, expected string, got \"${loggingPrefix}\".`);\n    }\n\n    this.loggingPrefix = loggingPrefix;\n  }\n\n  isValidAssessmentMode(assessmentMode) {\n    return Object.values(Options.AssessmentMode).includes(assessmentMode);\n  }\n\n  isValidValidation(validation) {\n    return typeof validation === 'boolean';\n  }\n\n  isValidPalette(palette) {\n    if (typeof palette === 'string') {\n      return Object.keys(colors.Palettes).includes(palette);\n    }\n    \n    if (!Array.isArray(palette)) {\n      return false;\n    }\n\n    return palette.length === 11 && palette.every(color => typeof color === 'string');\n  }\n\n  isValidLoggingPrefix(loggingPrefix) {\n    return typeof loggingPrefix === 'string';\n  }\n\n  isPreferredPalette(palette) {\n    return JSON.stringify(this.palette) == JSON.stringify(palette);\n  }\n\n  valueOf() {\n    return {\n      preferredAssessmentMode: this.preferredAssessmentMode,\n      validation: this.validation,\n      palette: this.palette,\n      loggingPrefix: this.loggingPrefix\n    };\n  }\n\n}\n","export const ElementWeights = {\n  META: 10,\n  TITLE: 9,\n  PRECONNECT: 8,\n  ASYNC_SCRIPT: 7,\n  IMPORT_STYLES: 6,\n  SYNC_SCRIPT: 5,\n  SYNC_STYLES: 4,\n  PRELOAD: 3,\n  DEFER_SCRIPT: 2,\n  PREFETCH_PRERENDER: 1,\n  OTHER: 0\n};\n\nexport const ElementDetectors = {\n  META: isMeta,\n  TITLE: isTitle,\n  PRECONNECT: isPreconnect,\n  ASYNC_SCRIPT: isAsyncScript,\n  IMPORT_STYLES: isImportStyles,\n  SYNC_SCRIPT: isSyncScript,\n  SYNC_STYLES: isSyncStyles,\n  PRELOAD: isPreload,\n  DEFER_SCRIPT: isDeferScript,\n  PREFETCH_PRERENDER: isPrefetchPrerender\n}\n\nexport const META_HTTP_EQUIV_KEYWORDS = [\n  'accept-ch',\n  'content-security-policy',\n  'content-type',\n  'default-style',\n  'delegate-ch',\n  'origin-trial',\n  'x-dns-prefetch-control'\n];\n\n\nexport function isMeta(element) {\n  const httpEquivSelector = META_HTTP_EQUIV_KEYWORDS.map(keyword => {\n    return `[http-equiv=\"${keyword}\" i]`;\n  }).join(', ');\n  \n  return element.matches(`meta:is([charset], ${httpEquivSelector}, [name=viewport]), base`);\n}\n\nexport function isTitle(element) {\n  return element.matches('title');\n}\n\nexport function isPreconnect(element) {\n  return element.matches('link[rel=preconnect]');\n}\n\nexport function isAsyncScript(element) {\n  return element.matches('script[src][async]');\n}\n\nexport function isImportStyles(element) {\n  const importRe = /@import/;\n\n  if (element.matches('style')) {\n    return importRe.test(element.textContent);\n  }\n\n  /* TODO: Support external stylesheets.\n  if (element.matches('link[rel=stylesheet][href]')) {\n    let response = fetch(element.href);\n    response = response.text();\n    return importRe.test(response);\n  } */\n\n  return false;\n}\n\nexport function isSyncScript(element) {\n  return element.matches('script:not([src][defer],[src][type=module],[src][async],[type*=json])');\n}\n\nexport function isSyncStyles(element) {\n  return element.matches('link[rel=stylesheet],style');\n}\n\nexport function isPreload(element) {\n  return element.matches('link:is([rel=preload], [rel=modulepreload])');\n}\n\nexport function isDeferScript(element) {\n  return element.matches('script[src][defer], script:not([src][async])[src][type=module]');\n}\n\nexport function isPrefetchPrerender(element) {\n  return element.matches('link:is([rel=prefetch], [rel=dns-prefetch], [rel=prerender])');\n}\n\nexport function isOriginTrial(element) {\n  return element.matches('meta[http-equiv=\"origin-trial\"i]');\n}\n\nexport function isMetaCSP(element) {\n  return element.matches('meta[http-equiv=\"Content-Security-Policy\" i]');\n}\n\nexport function getWeight(element) {\n  for ([id, detector] of Object.entries(ElementDetectors)) {\n    if (detector(element)) {\n      return ElementWeights[id];\n    }\n  }\n\n  return ElementWeights.OTHER;\n}\n\nexport function getHeadWeights(head) {\n  const headChildren = Array.from(head.children);\n  return headChildren.map(element => {\n    return {\n      element,\n      weight: getWeight(element)\n    };\n  });\n}\n","import { isMetaCSP, isOriginTrial } from \"./rules\";\n\nexport const VALID_HEAD_ELEMENTS = new Set([\n  'base',\n  'link',\n  'meta',\n  'noscript',\n  'script',\n  'style',\n  'template',\n  'title'\n]);\n\nexport const PRELOAD_SELECTOR = 'link:is([rel=\"preload\" i], [rel=\"modulepreload\" i])';\n\nexport function isValidElement(element) {\n  return VALID_HEAD_ELEMENTS.has(element.tagName.toLowerCase());\n}\n\nexport function hasValidationWarning(element) {\n  // Element itself is not valid.\n  if (!isValidElement(element)) {\n    return true;\n  }\n\n  // Children are not valid.\n  if (element.matches(`:has(:not(${Array.from(VALID_HEAD_ELEMENTS).join(', ')}))`)) {\n    return true;\n  }\n\n  // <title> is not the first of its type.\n  if (element.matches('title:is(:nth-of-type(n+2))')) {\n    return true;\n  }\n\n  // <base> is not the first of its type.\n  if (element.matches('base:has(~ base), base ~ base')) {\n    return true;\n  }\n  \n  // CSP meta tag anywhere.\n  if (isMetaCSP(element)) {\n    return true;\n  }\n\n  // Origin trial expired or cross-origin.\n  if (isInvalidOriginTrial(element)) {\n    return true;\n  }\n\n  // Preload is unnecessary.\n  if (isUnnecessaryPreload(element)) {\n    return true;\n  }\n\n  return false;\n}\n\nexport function getValidationWarnings(head) {\n  const validationWarnings = [];\n\n  const titleElements = Array.from(head.querySelectorAll('title'));\n  const titleElementCount = titleElements.length;\n  if (titleElementCount != 1) {\n    validationWarnings.push({\n      warning: `Expected exactly 1 <title> element, found ${titleElementCount}`,\n      elements: titleElements\n    });\n  }\n\n  const baseElements = Array.from(head.querySelectorAll('base'));\n  const baseElementCount = baseElements.length;\n  if (baseElementCount > 1) {\n    validationWarnings.push({\n      warning: `Expected at most 1 <base> element, found ${baseElementCount}`,\n      elements: baseElements\n    });\n  }\n  \n  const metaCSP = head.querySelector('meta[http-equiv=\"Content-Security-Policy\" i]');\n  if (metaCSP) {\n    validationWarnings.push({\n      warning: 'CSP meta tags disable the preload scanner due to a bug in Chrome. Use the CSP header instead. Learn more: https://crbug.com/1458493',\n      element: metaCSP\n    });\n  }\n\n  head.querySelectorAll('*').forEach(element => {\n    if (isValidElement(element)) {\n      return;\n    }\n\n    let root = element;\n    while (root.parentElement != head) {\n      root = root.parentElement;\n    }\n\n    validationWarnings.push({\n      warning: `${element.tagName} elements are not allowed in the <head>`,\n      element: root\n    });\n  });\n\n  const originTrials = Array.from(head.querySelectorAll('meta[http-equiv=\"Origin-Trial\" i]'));\n  originTrials.forEach(element => {\n    const metadata = validateOriginTrial(element);\n\n    if (metadata.warnings.length == 0) {\n      return;\n    }\n\n    validationWarnings.push({\n      warning: `Invalid origin trial token: ${metadata.warnings.join(', ')}`,\n      elements: [element],\n      element: metadata.payload\n    });\n  });\n\n  return validationWarnings;\n}\n\nexport function getCustomValidations(element) {\n  if (isOriginTrial(element)) {\n    return validateOriginTrial(element);\n  }\n\n  if (isMetaCSP(element)) {\n    return validateCSP(element);\n  }\n\n  if (isUnnecessaryPreload(element)) {\n    return validateUnnecessaryPreload(element);\n  }\n\n  return {};\n}\n\nfunction validateCSP(element) {\n  return {\n    warnings: ['meta CSP discouraged. See https://crbug.com/1458493.']\n  };\n}\n\nfunction isInvalidOriginTrial(element) {\n  if (!isOriginTrial(element)) {\n    return false;\n  }\n\n  const {warnings} = validateOriginTrial(element);\n  return warnings.length > 0;\n}\n\nfunction validateOriginTrial(element) {\n  const metadata = {\n    payload: null,\n    warnings: []\n  };\n\n  const token = element.getAttribute('content');\n  try {\n    metadata.payload = decodeOriginTrialToken(token);\n\n    if (metadata.payload.expiry < new Date()) {\n      metadata.warnings.push('expired');\n    }\n    if (!metadata.payload.isThirdParty && !isSameOrigin(metadata.payload.origin, document.location.href)) {\n      metadata.warnings.push('invalid origin');\n    }\n  } catch {\n    metadata.warnings.push('invalid token');\n  }\n\n  return metadata;\n}\n\n// Adapted from https://glitch.com/~ot-decode.\nfunction decodeOriginTrialToken(token) {\n  const buffer = new Uint8Array([...atob(token)].map(a => a.charCodeAt(0)));\n  const view = new DataView(buffer.buffer)\n  const length = view.getUint32(65, false)\n  const payload = JSON.parse((new TextDecoder()).decode(buffer.slice(69, 69 + length)));\n  payload.expiry = new Date(payload.expiry * 1000);\n  return payload;\n}\n\nfunction isSameOrigin(a, b) {\n  return new URL(a).origin === new URL(b).origin;\n}\n\nfunction isUnnecessaryPreload(element) {\n  if (!element.matches(PRELOAD_SELECTOR)) {\n    return false;\n  }\n\n  const href = element.getAttribute('href');\n  if (!href) {\n    return false;\n  }\n\n  const preloadedUrl = absolutifyUrl(href);\n\n  return findElementWithSource(element.parentElement, preloadedUrl) != null;\n}\n\nfunction findElementWithSource(root, sourceUrl) {\n  const linksAndScripts = Array.from(root.querySelectorAll(`link:not(${PRELOAD_SELECTOR}), script`));\n  \n  return linksAndScripts.find(e => {\n    const src = e.getAttribute('href') || e.getAttribute('src');\n    if (!src) {\n      return false;\n    }\n\n    return sourceUrl == absolutifyUrl(src);\n  });\n}\n\nfunction absolutifyUrl(href) {\n  return new URL(href, document.baseURI).href;\n}\n\nfunction validateUnnecessaryPreload(element) {\n  const href = element.getAttribute('href');\n  const preloadedUrl = absolutifyUrl(href);\n  const preloadedElement = findElementWithSource(element.parentElement, preloadedUrl);\n\n  if (!preloadedElement) {\n    throw new Error('Expected an invalid preload, but none found.');\n  }\n\n  return {\n    warnings: [`This preload has little to no effect. ${href} is already discoverable by another ${preloadedElement.tagName} element.`],\n  };\n}\n","export function validateHead(io, validation) {\n  const validationWarnings = validation.getValidationWarnings(io.getHead());\n  io.logValidationWarnings(validationWarnings);\n}\n\nexport function logWeights(io, validation, rules) {\n  const headElement = io.getHead();\n  const headWeights = rules.getHeadWeights(headElement).map(({element, weight}) => {\n    return {\n      weight,\n      element: io.getLoggableElement(element),\n      isValid: !validation.hasValidationWarning(element),\n      customValidations: validation.getCustomValidations(element)\n    };\n  });\n  \n  io.visualizeHead('Actual', headElement, headWeights);\n\n  const sortedWeights = Array.from(headWeights).sort((a, b) => b.weight - a.weight);\n  const sortedHead = document.createElement('head');\n  sortedWeights.forEach(({element}) => {\n    sortedHead.appendChild(element.cloneNode(true));\n  });\n\n  io.visualizeHead('Sorted', sortedHead, sortedWeights);\n\n  return headWeights;\n}\n"],"names":["$parcel$export","e","n","v","s","Object","defineProperty","get","set","enumerable","configurable","$aea261a6e7bc108a$export$921514c0345db5eb","hue","$aea261a6e7bc108a$export$e6952b12ade67489","$aea261a6e7bc108a$export$d68d0fda4a10dbc2","$aea261a6e7bc108a$export$738c3b9a44c87ecc","$aea261a6e7bc108a$export$9a82c28ef488e918","DEFAULT","PINK","BLUE","$87bbfeee3d3104be$export$8f8422ac5947a789","constructor","document1","options","output","window","console","document","isStaticHead","head","init","prefersDynamicAssessment","html","getStaticHTML","replace","staticDoc","implementation","createHTMLDocument","documentElement","innerHTML","querySelector","error","loggingPrefix","warn","url","location","href","response","fetch","text","getHead","stringifyElement","element","getAttributeNames","reduce","id","attr","CSS","escape","JSON","stringify","getAttribute","nodeName","getLoggableElement","selector","candidates","Array","from","querySelectorAll","length","candidateWrapper","createElement","elementWrapper","candidate","find","c","createElementFromSelector","tagName","match","attributes","forEach","attribute","key","value","split","setAttribute","slice","logElementFromSelector","weight","isValid","customValidations","viz","getElementVisualization","logElement","omitPrefix","visual","loggingLevel","args","style","isValidationEnabled","payload","warnings","push","warning","logValidationWarnings","elements","map","bind","getColor","palette","getHeadVisualization","styles","color","invalidColor","fill","join","visualizeHead","groupName","headElement","headWeights","headViz","groupCollapsed","log","groupEnd","$2bdfc45431959d07$exports","$2bdfc45431959d07$export$c019608e5b5bb4cb","preferredAssessmentMode","AssessmentMode","STATIC","validation","setPreferredAssessmentMode","setValidation","setPalette","setLoggingPrefix","DYNAMIC","Palettes","prefersStaticAssessment","isValidAssessmentMode","Error","setPreferredAssessmentModeToStatic","prefersStatic","mode","isValidValidation","isValidPalette","keys","isValidLoggingPrefix","assessmentMode","values","includes","isArray","every","isPreferredPalette","valueOf","$8ce28ca40f3ccf50$exports","$8ce28ca40f3ccf50$export$881088883fcab450","$8ce28ca40f3ccf50$export$6ade8bb3620eb74b","$8ce28ca40f3ccf50$export$daeb0db0c224decd","$8ce28ca40f3ccf50$export$e55aad21605f020a","$8ce28ca40f3ccf50$export$a3316bd0a640eb8b","$8ce28ca40f3ccf50$export$20e2051ffd813ee3","$8ce28ca40f3ccf50$export$be443fc6335656f0","$8ce28ca40f3ccf50$export$65983fc0a5543400","$8ce28ca40f3ccf50$export$9d6cdbffb13bee21","$8ce28ca40f3ccf50$export$226ad5ba23be83f0","$8ce28ca40f3ccf50$export$3d269f86e8bd1d24","$8ce28ca40f3ccf50$export$4d2ed086e1fec499","$8ce28ca40f3ccf50$export$b7417cf4a2235f73","$8ce28ca40f3ccf50$export$38a04d482ec50f88","$8ce28ca40f3ccf50$export$14b1a2f64a600585","$8ce28ca40f3ccf50$export$de32fe5d64aee40c","$8ce28ca40f3ccf50$export$5cc4a311ddbe699c","META","TITLE","PRECONNECT","ASYNC_SCRIPT","IMPORT_STYLES","SYNC_SCRIPT","SYNC_STYLES","PRELOAD","DEFER_SCRIPT","PREFETCH_PRERENDER","OTHER","httpEquivSelector","keyword","matches","importRe","test","textContent","detector","entries","headChildren","children","$640aadc6e9fc01d4$exports","$640aadc6e9fc01d4$export$79e124b7caef7aa9","$640aadc6e9fc01d4$export$5540ac2a18901364","$640aadc6e9fc01d4$export$a8257692ac88316c","$640aadc6e9fc01d4$export$eeefd08c3a6f8db7","$640aadc6e9fc01d4$export$b01ab94d0cd042a0","$640aadc6e9fc01d4$export$6c93e2175c028eeb","Set","has","toLowerCase","$640aadc6e9fc01d4$var$isInvalidOriginTrial","$640aadc6e9fc01d4$var$validateOriginTrial","$640aadc6e9fc01d4$var$isUnnecessaryPreload","validationWarnings","titleElements","titleElementCount","baseElements","baseElementCount","metaCSP","root","parentElement","originTrials","metadata","$640aadc6e9fc01d4$var$validateUnnecessaryPreload","preloadedUrl","$640aadc6e9fc01d4$var$absolutifyUrl","preloadedElement","$640aadc6e9fc01d4$var$findElementWithSource","token","a","b","$640aadc6e9fc01d4$var$decodeOriginTrialToken","buffer","Uint8Array","atob","charCodeAt","view","DataView","getUint32","parse","TextDecoder","decode","expiry","Date","isThirdParty","origin","URL","sourceUrl","linksAndScripts","src","baseURI","Options"],"version":3,"file":"capo.js.map"}